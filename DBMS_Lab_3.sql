DBMS LAB 3

CREATE TABLE DEPTS (
    DNAME VARCHAR(20),
    DNO INT PRIMARY KEY,
    MGRSTRDATE DATE
);

CREATE TABLE EMP(
    SSN INT PRIMARY KEY,
    FNAME VARCHAR(20),
    LNAME VARCHAR(20),
    ADDRESS VARCHAR(20),
    SEX CHAR(1),
    SALARY INT,
    SUPERSSN REFERENCES EMP(SSN) ON DELETE CASCADE,
    DNO REFERENCES DEPTS(DNO) ON DELETE CASCADE
);

CREATE TABLE DEPTLOC (
    DNO REFERENCES DEPTS(DNO),
    DLOC VARCHAR(20)
);

CREATE TABLE PRJ (
    PNO INT PRIMARY KEY,
    PNAME VARCHAR(20),
    PLOC VARCHAR(20),
    DNO REFERENCES DEPTS(DNO)
);

INSERT INTO PRJ VALUES(&PNO, '&PNAME' , '&PLOC', &DNO);
CREATE TABLE WORK(
    SSN REFERENCES EMP(SSN),
    PNO REFERENCES PRJ(PNO),
    HOURS NUMBER(2,2)
);

CREATE TABLE WORK(
    SSN REFERENCES EMP(SSN),
    PNO REFERENCES PRJ(PNO),
    HOURS NUMBER(2)
);
 

ALTER TABLE DEPTS ADD MGRSSN REFERENCES EMP(SSN) ON DELETE SET NULL;



INSERT INTO DEPTS (DNAME, DNO, MGRSTRDATE) VALUES ('ACCOUNTS', 1, '12-AUG-98');
INSERT INTO DEPTS (DNAME, DNO, MGRSTRDATE) VALUES('RESEARCH', 2, '24-JAN-00');
INSERT INTO DEPTS (DNAME, DNO, MGRSTRDATE) VALUES ('PRODUCTION', 3, '14-FEB-09');
INSERT INTO DEPTS (DNAME, DNO, MGRSTRDATE) VALUES('SALES', 4, '15-MAR-00');
INSERT INTO DEPTS (DNAME, DNO, MGRSTRDATE) VALUES ('TESTING', 5, '23-APR-02');

INSERT INTO EMP VALUES (111, 'JAMES', 'SCOTT', 'MYSORE', 'M', 123456, 111, 1);
INSERT INTO EMP VALUES (222, 'RAMESH', 'ARAVIND', 'BANGALORE', 'M', 345672, 111, 1);
INSERT INTO EMP VALUES (333, 'DAVID', 'HUSH', 'HONOLULU', 'M', 70000, 222, 1);
INSERT INTO EMP VALUES (444, 'KAVYA', 'BIND', 'GUWAHATI', 'F', 750000, 444, 1);
INSERT INTO EMP VALUES (555, 'HASHMI', 'KHAN', 'MUMBAI', 'F', 450000, 333, 1);
INSERT INTO EMP VALUES (666, 'PINKY', 'KHANNA', 'PUNJAB', 'F', 560000, 666, 1);
INSERT INTO EMP VALUES (777, 'KUSHAL', 'KUNDAN', 'ASSAM', 'M', 35000, 555, 4);
INSERT INTO EMP VALUES (888, 'ARIJITH', 'GUNDAL', 'ASSAM', 'M', 660000, 444, 5);

INSERT INTO PRJ (PNO, PNAME, PLOC, DNO) VALUES (10, 'P1', 'BLORE', 1);
INSERT INTO PRJ (PNO, PNAME, PLOC, DNO) VALUES (20, 'P2', 'MYSORE', 3);
INSERT INTO PRJ (PNO, PNAME, PLOC, DNO) VALUES (30, 'P3', 'MUMBAI', 4);
INSERT INTO PRJ (PNO, PNAME, PLOC, DNO) VALUES (40, 'P4', 'ASSAM', 4);
INSERT INTO PRJ (PNO, PNAME, PLOC, DNO) VALUES (50, 'IOT', 'PUNJAB', 5);
INSERT INTO PRJ (PNO, PNAME, PLOC, DNO) VALUES (60, 'P6', 'HONULULU', 1);


INSERT INTO WORK (SSN, PNO, HOURS) VALUES (111, 50, 5);
INSERT INTO WORK (SSN, PNO, HOURS) VALUES (222, 50, 10);
INSERT INTO WORK (SSN, PNO, HOURS) VALUES (333, 50, 7);
INSERT INTO WORK (SSN, PNO, HOURS) VALUES (444, 20, 8);
INSERT INTO WORK (SSN, PNO, HOURS) VALUES (555, 10, 3);
INSERT INTO WORK (SSN, PNO, HOURS) VALUES (666, 30, 1);
INSERT INTO WORK (SSN, PNO, HOURS) VALUES (777, 40, 12);


UPDATE DEPTS SET MGRSSN = 333 WHERE DNO = 1;
UPDATE DEPTS SET MGRSSN = 111 WHERE DNO = 2;
UPDATE DEPTS SET MGRSSN = 444 WHERE DNO = 3;
UPDATE DEPTS SET MGRSSN = 555 WHERE DNO = 4;
UPDATE DEPTS SET MGRSSN = 777 WHERE DNO = 5;


SELECT * FROM EMP;
SELECT * FROM DEPTS;
SELECT * FROM PRJ;
SELECT * FROM WORK;

A) Make a list of all project numbers for projects that involve an employee whose last name is ‘Scott’, either as a worker or as a manager of the department that Controls the project. 
-- A. SELECT DISTINCT P.PNO FROM PRJ P, DEPTS D, EMP E WHERE E.DNO=D.DNO AND D.DNO = P.DNO AND (E.LNAME = 'SCOTT' OR D.MGRSSN IN (SELECT SSN FROM EMP WHERE LNAME='SCOTT'));

B) Show the resulting salaries if every employee working on the ‘IoT’ project is Given a 10 percent raise. 
-- B. SELECT E.SSN , E.FNAME,E.LNAME, 1.1*E.SALARY AS RAISEDSAL FROM EMP E , PRJ P, WORK W WHERE P.PNAME = 'IOT' AND P.PNO = W.PNO AND E.SSN = W.SSN;

C) Find the sum of the salaries of all employees of the ‘Accounts’ department, as well as the maximum salary, the minimum salary, and the average salary in this department.
-- C. SELECT SUM(SALARY) AS SUMSAL, AVG(SALARY) AS AVGSAL, MIN(SALARY) AS MINSAL, MAX(SALARY) AS MAXSAL FROM EMP E, DEPTS D WHERE E.DNO = D.DNO AND D.DNAME='ACCOUNTS';

D) Retrieve the name of each employee who works on the entire projects controlled by department number 5. 
-- D. SELECT E.FNAME , E.LNAME FROM EMP E WHERE NOT EXISTS ((SELECT PNO FROM PRJ WHERE DNO='5') MINUS (SELECT PNO FROM WORK WHERE E.SSN=SSN));

E) For each department that has more than five employees, retrieve the department number and the number of its employees who are making more than Rs. 6,00,000.
-- E. SELECT D.DNO,D.DNAME,E.FNAME,E.LNAME ,COUNT(*) AS NOOFEMP FROM EMP E, DEPTS D WHERE E.DNO=D.DNO AND E.SALARY>600000 AND D.DNO IN(SELECT E1.DNO FROM EMP E1 GROUP BY E1.DNO HAVING COUNT(*)>5) GROUP BY D.DNO,D.DNAME,E.FNAME,E.LNAME;




UPDATE EMP SET DNO = 50 WHERE SSN = 1;

DROP TABLE DEPTS CASCADE CONSTRAINTS; 