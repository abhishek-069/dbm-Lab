
# DBMS Lab - 5

## 1. Creating Tables
```sql
-- Create Tables
CREATE TABLE STUDENT (
    SNUM INT PRIMARY KEY,
    SNAME VARCHAR(20),
    MAJOR VARCHAR(10),
    LEV VARCHAR(20),
    AGE INT
);

CREATE TABLE FACULTY (
    FID INT PRIMARY KEY,
    FNAME VARCHAR(20),
    DEPID INT
);

CREATE TABLE CLASS (
    CNAME VARCHAR(20) PRIMARY KEY,
    MEETS_AT VARCHAR(20),
    ROOM VARCHAR(20),
    FID INT,
    FOREIGN KEY (FID) REFERENCES FACULTY(FID) ON DELETE SET NULL
);

CREATE TABLE ENROLLED (
    SNUM INT,
    CNAME VARCHAR(20),
    FOREIGN KEY (SNUM) REFERENCES STUDENT(SNUM),
    FOREIGN KEY (CNAME) REFERENCES CLASS(CNAME)
);
```
## 2. Inserting Data
```sql
-- Insert Data into STUDENT
INSERT INTO STUDENT VALUES (1, 'ANDY', 'CSE', 'JR', 20);
INSERT INTO STUDENT VALUES (2, 'HELEN', 'ARTS', 'JR', 19);
INSERT INTO STUDENT VALUES (3, 'BOB', 'PSYCHOLOGY', 'GR', 22);
INSERT INTO STUDENT VALUES (4, 'PHAM', 'HISTORY', 'SR', 21);
INSERT INTO STUDENT VALUES (5, 'ZOLA', 'CSE', 'SR', 23);
INSERT INTO STUDENT VALUES (6, 'ABHI', 'CSE', 'JR', 20);
INSERT INTO STUDENT VALUES (7, 'TARA', 'ARTS', 'JR', 19);

-- Insert Data into FACULTY
INSERT INTO FACULTY VALUES (22, 'KERA', 88);
INSERT INTO FACULTY VALUES (23, 'NIALL', 77);
INSERT INTO FACULTY VALUES (24, 'RAVI', 33);
INSERT INTO FACULTY VALUES (27, 'LOU', 66);
INSERT INTO FACULTY VALUES (31, 'JANE', 44);
INSERT INTO FACULTY VALUES (34, 'PAYNE', 55);
INSERT INTO FACULTY VALUES (36, 'RAKESH', 22);

-- Insert Data into CLASS
INSERT INTO CLASS VALUES ('HIS38', '12:00', 'R123', 34);
INSERT INTO CLASS VALUES ('CS293', '12:00', 'R124', 23);
INSERT INTO CLASS VALUES ('CS262', '2:00', 'R125', 24);
INSERT INTO CLASS VALUES ('PY331', '9:00', 'R126', 27);
INSERT INTO CLASS VALUES ('AR32', '9:00', 'R127', 36);
INSERT INTO CLASS VALUES ('AR36', '10:00', 'R128', 31);
INSERT INTO CLASS VALUES ('PY332', '8:00', 'R128', 22);
INSERT INTO CLASS VALUES ('HIS37', '5:00', 'R128', 34);
INSERT INTO CLASS VALUES ('HIS34', '4:00', 'R128', 31);
INSERT INTO CLASS VALUES ('CS289', '2:00', 'R128', 22);

-- Insert Data into ENROLLED
INSERT INTO ENROLLED VALUES (1, 'CS262');
INSERT INTO ENROLLED VALUES (1, 'AR32');
INSERT INTO ENROLLED VALUES (2, 'AR32');
INSERT INTO ENROLLED VALUES (2, 'PY331');
INSERT INTO ENROLLED VALUES (3, 'PY331');
INSERT INTO ENROLLED VALUES (3, 'HIS34');
INSERT INTO ENROLLED VALUES (4, 'HIS38');
INSERT INTO ENROLLED VALUES (5, 'CS293');
INSERT INTO ENROLLED VALUES (5, 'HIS38');
INSERT INTO ENROLLED VALUES (6, 'CS262');
```
## 3. View Tables
```sql
-- Select all from STUDENT, FACULTY, ENROLLED, CLASS tables
SELECT * FROM STUDENT;
SELECT * FROM FACULTY;
SELECT * FROM ENROLLED;
SELECT * FROM CLASS;
```

## 4. Queries 
```sql
-- A) Find the names of all Juniors (level = JR) who are enrolled in a class taught by Rakesh.
SELECT DISTINCT S.SNAME 
FROM STUDENT S 
JOIN ENROLLED E ON S.SNUM = E.SNUM 
JOIN CLASS C ON E.CNAME = C.CNAME 
JOIN FACULTY F ON C.FID = F.FID 
WHERE S.LEV = 'JR' AND F.FNAME = 'RAKESH';

-- B) Find the age of the oldest student who is either a history major or enrolled in a course taught by Ravi.
SELECT MAX(S.AGE) 
FROM STUDENT S 
WHERE S.MAJOR = 'HISTORY' OR S.SNUM IN (
    SELECT E.SNUM 
    FROM ENROLLED E 
    JOIN CLASS C ON E.CNAME = C.CNAME 
    JOIN FACULTY F ON C.FID = F.FID 
    WHERE F.FNAME = 'RAVI'
);

-- C) Find the names of all students who are enrolled in two classes that meet at the same time. 
SELECT DISTINCT S.SNAME 
FROM STUDENT S 
JOIN ENROLLED E1 ON S.SNUM = E1.SNUM 
JOIN ENROLLED E2 ON S.SNUM = E2.SNUM 
JOIN CLASS C1 ON E1.CNAME = C1.CNAME 
JOIN CLASS C2 ON E2.CNAME = C2.CNAME 
WHERE C1.MEETS_AT = C2.MEETS_AT AND C1.CNAME <> C2.CNAME;

-- D) For each faculty member that has taught classes only in room R128, print the faculty memberâ€™s name and the total number of classes she or he has taught.
SELECT F.FNAME, COUNT(C.CNAME) AS TOTALCLASSES 
FROM FACULTY F 
JOIN CLASS C ON F.FID = C.FID 
WHERE F.FID NOT IN (
    SELECT DISTINCT C2.FID 
    FROM CLASS C2 
    WHERE C2.ROOM <> 'R128'
) 
GROUP BY F.FNAME;

-- E) Create a view that contains the details of students along with the name of the courses enrolled.
CREATE VIEW STUDENTCOURSEDETAILS AS 
SELECT S.SNUM, S.SNAME, S.MAJOR, S.LEV, S.AGE, C.CNAME AS COURSENAME 
FROM STUDENT S 
JOIN ENROLLED E ON S.SNUM = E.SNUM 
JOIN CLASS C ON E.CNAME = C.CNAME;

-- View the created view 
SELECT * FROM STUDENTCOURSEDETAILS;
```