
# DBMS Lab - 1

## 1. Creating Tables

```sql
CREATE TABLE PUBLISHER (
  PUBLISHER_NAME VARCHAR(20) PRIMARY KEY,
  ADDRESS VARCHAR(45),
  PHONE_NO INTEGER
);

CREATE TABLE BOOK (
  BOOK_ID INTEGER PRIMARY KEY,
  TITLE VARCHAR(20),
  PUB_YEAR VARCHAR(20),
  PUBLISHER_NAME REFERENCES PUBLISHER(PUBLISHER_NAME) ON DELETE CASCADE
);

CREATE TABLE LIBRARY_BRANCH (
  BRANCH_ID INTEGER PRIMARY KEY,
  BRANCH_NAME VARCHAR(20),
  ADDRESS VARCHAR(20)
);

CREATE TABLE BOOK_COPIES (
  NO_OF_COPIES INTEGER,
  BOOK_ID REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
  BRANCH_ID REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE,
  PRIMARY KEY (BOOK_ID, BRANCH_ID)
);

CREATE TABLE BOOK_AUTHORS (
  AUTHOR_NAME VARCHAR(20),
  BOOK_ID REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
  PRIMARY KEY (AUTHOR_NAME, BOOK_ID)
);

CREATE TABLE CARD (
  CARD_NO INTEGER PRIMARY KEY
);

CREATE TABLE BOOK_LENDING (
  DATE_OUT DATE,
  DUE_DATE DATE,
  BOOK_ID REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
  BRANCH_ID REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE,
  CARD_NO REFERENCES CARD(CARD_NO) ON DELETE CASCADE,
  PRIMARY KEY (BOOK_ID, BRANCH_ID, CARD_NO)
);
```

## 2. Describe Tables

```sql
DESC PUBLISHER;
DESC BOOK;
DESC BOOK_AUTHORS;
DESC BOOK_COPIES;
DESC LIBRARY_BRANCH;
DESC CARD;
DESC BOOK_LENDING;
```

## 3. Inserting Data

```sql
-- Publishers
INSERT INTO PUBLISHER VALUES('MCGRAW-HILL', 'BANGALORE', 2134567890);
INSERT INTO PUBLISHER VALUES('PEARSON', 'NEW DELHI', 2134567891);
INSERT INTO PUBLISHER VALUES('RANSOM HOUSE', 'HYDERABAD', 2134567892);
INSERT INTO PUBLISHER VALUES('HACHETTE LIVER', 'CHENNAI', 2134567893);
INSERT INTO PUBLISHER VALUES('GRUPO PLANETA', 'BANGALORE', 2134567894);

-- Books
INSERT INTO BOOK VALUES(1,'DBMS','JAN-2025', 'MCGRAW-HILL');
INSERT INTO BOOK VALUES(2,'DAA', 'FEB-2025','PEARSON');
INSERT INTO BOOK VALUES(3,'SE', 'MAR-2025','RANSOM HOUSE');
INSERT INTO BOOK VALUES(4,'DSA','APL-2025','HACHETTE LIVER');
INSERT INTO BOOK VALUES(5,'OS','MAY-2025','GRUPO PLANETA');

-- Authors
INSERT INTO BOOK_AUTHORS VALUES('NAVATHE',1);
INSERT INTO BOOK_AUTHORS VALUES('NAVATHE',2);
INSERT INTO BOOK_AUTHORS VALUES('TANENBAUM',3);
INSERT INTO BOOK_AUTHORS VALUES('EDWARD ANGEL',4);
INSERT INTO BOOK_AUTHORS VALUES('GALVIN',5);

-- Library Branches
INSERT INTO LIBRARY_BRANCH VALUES(10, 'RR NAGAR', 'BANGLURU');
INSERT INTO LIBRARY_BRANCH VALUES(11, 'RNSIT', 'BANGLURU');
INSERT INTO LIBRARY_BRANCH VALUES(12, 'RAJAJI NAGAR', 'BANGLURU');
INSERT INTO LIBRARY_BRANCH VALUES(13, 'NITTE', 'MANGALURU');
INSERT INTO LIBRARY_BRANCH VALUES(14, 'MANIPAL', 'MANGALURU');

-- Book Copies
INSERT INTO BOOK_COPIES VALUES(10,1,10); 
INSERT INTO BOOK_COPIES VALUES(5,1,11); 
INSERT INTO BOOK_COPIES VALUES(2,2,12); 
INSERT INTO BOOK_COPIES VALUES(5,2,13); 
INSERT INTO BOOK_COPIES VALUES(7,3,14); 
INSERT INTO BOOK_COPIES VALUES(1,5,10); 
INSERT INTO BOOK_COPIES VALUES(3,4,11);

-- Cards
INSERT INTO CARD VALUES(100);
INSERT INTO CARD VALUES(101);
INSERT INTO CARD VALUES(102);
INSERT INTO CARD VALUES(103);
INSERT INTO CARD VALUES(104);

-- Lending
INSERT INTO BOOK_LENDING VALUES('01-JAN-2017', '01-JUN-2017', 1, 10, 101);
INSERT INTO BOOK_LENDING VALUES('11-JAN-2017', '11-MAR-2017', 3, 14, 101);
INSERT INTO BOOK_LENDING VALUES('21-FEB-2017', '21-APR-2017', 2, 13, 101);
INSERT INTO BOOK_LENDING VALUES('15-MAR-2017', '15-JUL-2017', 4, 11, 101);
INSERT INTO BOOK_LENDING VALUES('12-APR-2017', '12-MAY-2017', 5, 12, 104);
```

## 4. View & Select Queries

```sql
-- View Tables
SELECT * FROM PUBLISHER;
SELECT * FROM BOOK;
SELECT * FROM BOOK_COPIES;
SELECT * FROM BOOK_AUTHORS;
SELECT * FROM LIBRARY_BRANCH;
SELECT * FROM BOOK_LENDING;
SELECT * FROM CARD;

-- Complex Select
SELECT B.BOOK_ID, B.TITLE, B.PUBLISHER_NAME, A.AUTHOR_NAME, C.NO_OF_COPIES, L.BRANCH_ID
FROM BOOK B, BOOK_AUTHORS A, BOOK_COPIES C, LIBRARY_BRANCH L
WHERE B.BOOK_ID = A.BOOK_ID AND B.BOOK_ID = C.BOOK_ID AND L.BRANCH_ID = C.BRANCH_ID;

-- Borrowed > 3 books
SELECT CARD_NO
FROM BOOK_LENDING
WHERE DATE_OUT BETWEEN '11-JAN-2017' AND '12-JUN-2017'
GROUP BY CARD_NO
HAVING COUNT(*) > 3;

-- Delete Book
DELETE FROM BOOK WHERE BOOK_ID = 3;
```

## 5. Extra Queries

```sql
-- Average book copies
SELECT AVG(NO_OF_COPIES) AS AVG_COPIES FROM BOOK_COPIES;

-- Branch with most books
SELECT BRANCH_ID, SUM(NO_OF_COPIES) AS TOTAL_BOOKS
FROM BOOK_COPIES
GROUP BY BRANCH_ID
ORDER BY TOTAL_BOOKS DESC
FETCH FIRST 2 ROWS ONLY;

-- Author with most books
SELECT AUTHOR_NAME, COUNT(BOOK_ID) AS TOTAL_BOOKS
FROM BOOK_AUTHORS
GROUP BY AUTHOR_NAME
ORDER BY TOTAL_BOOKS DESC
FETCH FIRST 1 ROWS ONLY;

-- Books borrowed more than once
SELECT BOOK_ID, COUNT(*) AS BORROW_COUNT
FROM BOOK_LENDING
GROUP BY BOOK_ID
HAVING COUNT(*) > 1;

-- Most borrowed book with title
SELECT B.BOOK_ID, B.TITLE, COUNT(BL.BOOK_ID) AS TOTAL_BORROWS
FROM BOOK_LENDING BL
JOIN BOOK B ON BL.BOOK_ID = B.BOOK_ID
GROUP BY B.BOOK_ID, B.TITLE
ORDER BY TOTAL_BORROWS DESC
FETCH FIRST 1 ROWS ONLY;

-- Top borrower
SELECT CARD_NO, COUNT(*) AS TOTAL_BORROWED
FROM BOOK_LENDING
GROUP BY CARD_NO
ORDER BY TOTAL_BORROWED DESC
FETCH FIRST 1 ROWS ONLY;

-- Books in multiple branches
SELECT BOOK_ID, COUNT(DISTINCT BRANCH_ID) AS BRANCH_COUNT
FROM BOOK_COPIES
GROUP BY BOOK_ID
HAVING COUNT(DISTINCT BRANCH_ID) > 1;

-- Publisher with most books
SELECT PUBLISHER_NAME, COUNT(*) AS TOTAL_BOOKS
FROM BOOK
GROUP BY PUBLISHER_NAME
ORDER BY TOTAL_BOOKS DESC
FETCH FIRST 1 ROWS ONLY;

-- Most recent borrowed book
SELECT * FROM BOOK_LENDING
ORDER BY DATE_OUT DESC
FETCH FIRST 1 ROWS ONLY;

-- Books borrowed in Jan and Feb 2017
SELECT DISTINCT BOOK_ID  
FROM BOOK_LENDING  
WHERE TO_CHAR(DATE_OUT, 'YYYY-MM') = '2017-01'  
INTERSECT  
SELECT DISTINCT BOOK_ID  
FROM BOOK_LENDING  
WHERE TO_CHAR(DATE_OUT, 'YYYY-MM') = '2017-02';
```
